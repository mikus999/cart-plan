(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{162:function(t,e,a){(e=a(10)(!1)).push([t.i,".aa[data-v-043991a4]{background:#424242!important}@keyframes blink-data-v-043991a4{0%{background-color:red}50%{background-color:rgba(255,0,0,.5)}to{background-color:red}}@-webkit-keyframes blink-data-v-043991a4{0%{background-color:red}50%{background-color:rgba(255,0,0,.5)}to{background-color:red}}.save-btn[data-v-043991a4]{transition:all .5s ease-in-out;-webkit-animation:blink-data-v-043991a4 1.5s ease-in-out infinite normal;animation:blink-data-v-043991a4 1.5s ease-in-out infinite normal}",""]),t.exports=e},196:function(t,e,a){(e=a(10)(!1)).push([t.i,'.dashed-border[data-v-1b901821]{border:thin dashed "grey"}',""]),t.exports=e},73:function(t,e,a){"use strict";var n=a(1),i=a.n(n),r=a(6),s=a.n(r),o=a(11),l=a(48),c=a(92);function u(t,e,a,n,i,r,s){try{var o=t[r](s),l=o.value}catch(t){return void a(t)}o.done?e(l):Promise.resolve(l).then(n,i)}function d(t){return function(){var e=this,a=arguments;return new Promise((function(n,i){var r=t.apply(e,a);function s(t){u(r,n,i,s,o,"next",t)}function o(t){u(r,n,i,s,o,"throw",t)}s(void 0)}))}}var h={name:"ShiftCard",mixins:[o.b,o.c,l.a],components:{Leaflet:c.a},props:{shift:{type:Object},schedule:{type:Object},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"170px"},onlyinfo:{type:Boolean,default:!1}},data:function(){return{request:!1,trade:!1,locationOverlay:!1}},created:function(){this.request=this.isShiftMember,this.trade=4==this.myShiftStatus},computed:{isShiftMember:function(){return this.shift.users.map((function(t){return t.id})).indexOf(this.user.id)>-1},hasRequestedTrade:function(){return 4==this.myShiftStatus},myShiftStatus:function(){var t=this,e=null,a=this.shift.users.filter((function(e){return e.id===t.user.id}));return a.length>0&&(e=a[0].pivot.status),e},shiftFull:function(){var t=!1;1==this.team.setting_shift_request_autoapproval&&(t=this.shift.users.length>=this.shift.max_participants);return t},mapWidth:function(){return this.$vuetify.breakpoint.width<500?this.$vuetify.breakpoint.width-50+"px":"500px"}},methods:{showButton:function(t){var e=!1;switch(t){case"request":e=1==this.schedule.status&&(!this.shiftFull||this.request)||2==this.schedule.status&&(0==this.myShiftStatus||1==this.myShiftStatus);break;case"trade":e=2==this.schedule.status&&this.myShiftStatus>1}return e},dayOfWeek:function(t){var e=[];return(e=this.$dayjs().localeData().weekdaysShort())[7]=e[0],e[t]},updateShiftUser:function(){var t=this;return d(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=1==t.team.setting_shift_request_autoapproval?2:1,n=null,t.request=!t.request,n=t.request?"/api/schedules/joinshift":"/api/schedules/leaveshift",e.next=6,s()({method:"post",url:n,data:{user_id:t.user.id,shift_id:t.shift.id,status:a}}).then((function(e){t.shift.users=e.data.shiftusers}));case 6:case"end":return e.stop()}}),e)})))()},showLocationOverlay:function(){this.locationOverlay=!0},updateTrade:function(){var t=this;return d(i.a.mark((function e(){var a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.trade,e.t0){e.next=5;break}return e.next=4,t.$root.$confirm(t.$t("shifts.confirm_trade_offer"),null,"info");case 4:e.t0=e.sent;case 5:if(!e.t0){e.next=18;break}if(null,t.trade=!t.trade,a=4==t.myShiftStatus?2:4,!t.notificationsEnabled||4!=a){e.next=16;break}return n=t.message_trade_offer(t.user.name,t.shift.time_start,t.shift.time_end,t.shift.location.name),r=t.team.notificationsettings.telegram_channel_id,e.next=14,t.mtInitialize();case 14:return e.next=16,t.sendMessage(r,n);case 16:return e.next=18,s()({method:"post",url:"/api/schedules/shiftuserstatus",data:{user_id:t.user.id,shift_id:t.shift.id,status:a}}).then((function(e){t.shift.users=e.data.shiftusers}));case 18:case"end":return e.stop()}}),e)})))()},returnZero:function(t){return t<0?0:t}}},p=a(2),f=a.n(p),v=a(196),m=a.n(v),g={insert:"head",singleton:!1},y=(f()(m.a,g),m.a.locals,a(8)),b=a(9),_=a.n(b),w=a(103),k=a(221),S=a(5),x=a(658),C=a(226),O=a(113),M=a(232),D=a(659),L=a(657),T=Object(y.a)(h,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{attrs:{outlined:!t.onlyinfo,hover:"",width:t.width}},[a("v-card-title",{staticClass:"justify-center text-h6",style:"background-color: "+(null!==t.shift.location.color_code?t.shift.location.color_code:"")},[t._v("\n    "+t._s(t.shift.location.name)+"\n  ")]),t._v(" "),a("v-card-subtitle",{staticClass:"text-center font-weight-bold",style:"background-color: "+(null!==t.shift.location.color_code?t.shift.location.color_code:"")},[a("div",[t._v(t._s(t.$dayjs(t.shift.time_start).format("ddd, L")))]),t._v(" "),a("div",[t._v(t._s(t._f("formatTime")(t.shift.time_start))+" - "+t._s(t._f("formatTime")(t.shift.time_end)))])]),t._v(" "),a("v-card-text",{style:"overflow-y: auto; height: "+t.height},[t.onlyinfo?a("div",{staticClass:"text-overline"},[t._v(t._s(t.$t("shifts.participants")))]):t._e(),t._v(" "),t._l(t.shift.users,(function(e){return a("div",{key:e.id,staticClass:"ma-2",attrs:{title:t.shiftStatus[e.pivot.status].text,disabled:""}},[a("v-icon",{staticClass:"ml-n4 mr-2",attrs:{color:t.shiftStatus[e.pivot.status].color}},[t._v(t._s(t.shiftStatus[e.pivot.status].icon))]),t._v(" "),a("span",{class:t.shiftStatus[e.pivot.status].color+"--text"},[t._v(t._s(e.name))])],1)})),t._v(" "),t._l(t.returnZero(t.shift.max_participants-t.shift.users.length),(function(e){return a("div",{key:e,staticClass:"ma-2",attrs:{disabled:""}},[a("div",{staticClass:"ml-n5 dashed-border rounded",attrs:{width:"100%"}},[a("v-icon",{staticClass:"ml-1 mr-2",attrs:{color:"grey"}},[t._v("mdi-account-outline")]),t._v(" "),a("span",[t._v(t._s(t.$t("general.available")))])],1)])})),t._v(" "),a("div",{staticClass:"mt-8"})],2),t._v(" "),t.onlyinfo?t._e():a("v-divider",{staticClass:"ma-0"}),t._v(" "),t.onlyinfo?a("v-card-actions",[a("v-spacer"),t._v(" "),a("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){return t.$emit("close")}}},[t._v("\n      "+t._s(t.$t("general.close"))+"\n    ")])],1):a("v-card-actions",[a("v-row",{attrs:{dense:""}},[a("v-col",{staticClass:"text-center"},[a("v-btn",{staticClass:"me-2",attrs:{icon:"",disabled:null===t.shift.location.map},on:{click:function(e){return e.stopPropagation(),t.showLocationOverlay(e)}}},[a("v-icon",[t._v("mdi-map-search")])],1)],1),t._v(" "),a("v-col",{staticClass:"text-center"},[a("v-btn",{staticClass:"me-2",attrs:{disabled:!t.showButton("request"),color:(t.request&&t.myShiftStatus,""),icon:""},on:{click:function(e){return e.stopPropagation(),t.updateShiftUser(e)}}},[a("v-icon",[t._v(t._s(t.request?"mdi-account-minus":"mdi-account-plus"))])],1)],1),t._v(" "),a("v-col",{staticClass:"text-center"},[a("v-btn",{attrs:{disabled:!t.showButton("trade"),color:t.trade?"blue":"",icon:""},on:{click:function(e){return e.stopPropagation(),t.updateTrade(e)}}},[a("v-icon",[t._v("mdi-account-convert")])],1)],1)],1)],1),t._v(" "),a("v-overlay",{attrs:{value:t.locationOverlay,dark:"dark"==t.theme},nativeOn:{click:function(e){t.locationOverlay=!1}}},[a("Leaflet",{attrs:{location:t.shift.location,fill:t.shift.location.color_code,width:t.mapWidth,height:"500px",readonly:""},on:{close:function(e){t.locationOverlay=!1}},nativeOn:{click:function(t){t.stopPropagation()}}})],1)],1)}),[],!1,null,"1b901821",null);e.a=T.exports;_()(T,{VBtn:w.a,VCard:k.a,VCardActions:S.a,VCardSubtitle:S.b,VCardText:S.c,VCardTitle:S.d,VCol:x.a,VDivider:C.a,VIcon:O.a,VOverlay:M.a,VRow:D.a,VSpacer:L.a})},92:function(t,e,a){"use strict";var n=a(1),i=a.n(n),r=a(6),s=a.n(r),o=a(11),l=(a(506),a(19)),c=a.n(l),u=a(634),d=a(635),h=a(636),p=a(637);a(507),a(508),a(509);function f(t,e,a,n,i,r,s){try{var o=t[r](s),l=o.value}catch(t){return void a(t)}o.done?e(l):Promise.resolve(l).then(n,i)}delete c.a.Icon.Default.prototype._getIconUrl,c.a.Icon.Default.mergeOptions({iconRetinaUrl:"/images/leaflet/marker-icon-2x.png",iconUrl:"/images/leaflet/marker-icon.png",shadowUrl:"/images/leaflet/marker-shadow.png"});var v={name:"Leaflet",mixins:[o.a],components:{LMap:u.a,LTileLayer:d.a,LControl:h.a,LMarker:p.a},props:{location:{type:Object},readonly:{type:Boolean,default:!1},width:{type:[String,Number],default:"500px"},height:{type:[String,Number],default:"500px"},fill:{type:String,default:"#777777"}},data:function(){return{map:null,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',edited:null,center:Object(l.latLng)(1,1),zoom:13,shapeOptions:{fillColor:this.getFill,fillOpacity:.4,stroke:!0,weight:2,color:"#999999",editable:!0,clickable:!0,bubblingMouseEvents:!1},markerOptions:{draggable:!0,clickable:!0,bubblingMouseEvents:!1},locatorOptions:{enableHighAccuracy:!0},closeBtn:{display:"fixed",top:"50px",left:"50px",zIndex:"500"},mapDraggable:this.readonly,mapCursor:this.readonly?null:"default",mapType:"roadmap",drawingMode:0,dataLayer:null,geoJson:null,selectedShape:null,isChanged:null,drawingManager:null,shapes:null,drawControl:null,drawMode:null,drawFeature:null}},computed:{getFill:function(){return this.fill?this.fill:this.location.color_code}},created:function(){},mounted:function(){this.closeBtn.left=this.$refs.mainDiv.clientWidth-50+"px"},methods:{onMapReady:function(){this.map=this.$refs.map.mapObject,null===this.location.map&&this.getMyPosition(),this.loadDrawControl()},getMyPosition:function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){t.center=Object(l.latLng)(e.coords.latitude,e.coords.longitude)}),null,this.locatorOptions)},recenterMap:function(){this.map.fitBounds(this.shapes.getBounds())},loadDrawControl:function(){var t=this;this.drawControl=new c.a.Control.Draw({draw:!1}),this.map.addControl(this.drawControl),this.map.addControl(new c.a.Control.Fullscreen),this.shapes=new c.a.FeatureGroup,this.map.addLayer(this.shapes),this.map.on(c.a.Draw.Event.CREATED,(function(e){var a=e.layerType,n=e.layer,i=n.feature=n.feature||{};i.type="Feature",i.properties=i.properties||{},i.properties.shape=a,"circle"==a&&(i.properties.radius=n.getRadius()),t.setShapeEvents(n),t.shapes.addLayer(n),t.drawMode=null})),this.map.on("click",(function(e){t.clearSelection()})),document.addEventListener("keydown",(function(e){switch(e.key){case"Delete":case"Backspace":t.deleteSelection();break;case"Escape":t.clearSelection()}})),this.loadGeoJSON()},setShapeEvents:function(t){var e=this;this.readonly||t.on("click",(function(t){c.a.DomEvent.stopPropagation(t),e.setSelection(t.sourceTarget)}))},updateMapType:function(){switch(this.mapType){case"satellite":this.url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",this.attribution='&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',this.mapType="roadmap";break;case"roadmap":this.url="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",this.attribution="Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",this.mapType="satellite"}},changeDrawingMode:function(t){if(this.drawMode===t)this.drawMode=null,this.drawFeature.disable(),this.drawFeature=null;else{switch(null!==this.drawFeature&&(this.drawFeature.disable(),this.drawFeature=null),t){case"polygon":this.drawFeature=new c.a.Draw.Polygon(this.map,this.shapeOptions);break;case"rectangle":this.drawFeature=new c.a.Draw.Rectangle(this.map,this.shapeOptions);break;case"circle":this.drawFeature=new c.a.Draw.Circle(this.map,this.shapeOptions);break;case"marker":this.drawFeature=new c.a.Draw.Marker(this.map,this.markerOptions)}this.drawMode=t,this.drawFeature.enable()}},isActiveButton:function(t){var e=null;return null!==this.drawMode&&this.drawMode===t&&(e=!0),e},revertChanges:function(){this.shapes.clearLayers(),this.loadGeoJSON()},loadGeoJSON:function(){if(null!==this.location.map){var t=JSON.parse(this.location.map);c.a.geoJson(t,{style:this.shapeOptions,pointToLayer:function(t,e){return t.properties.radius?new c.a.Circle(e,t.properties.radius):new c.a.Marker(e)},onEachFeature:this.loadFeature});this.recenterMap()}this.isChanged=null},loadFeature:function(t,e){"rectangle"===t.properties.shape&&(e=new c.a.Rectangle(e.getLatLngs())),this.setShapeEvents(e),this.shapes.addLayer(e)},saveShapes:function(){this.saveToDB()},saveToDB:function(){var t,e=this;return(t=i.a.mark((function t(){var a,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.lodash.cloneDeep(e.location),n="/api/teams/"+e.team.id+"/locations/"+a.id,r=null,e.shapes.getLayers().length>0&&(r=JSON.stringify(e.shapes.toGeoJSON())),e.location.map=r,a.map=r,t.next=9,s()({method:"patch",url:n,data:a}).then((function(t){e.recenterMap(),e.showSnackbar(e.$t("teams.success_location_update"),"success"),e.isChanged=null}));case 9:case"end":return t.stop()}}),t)})),function(){var e=this,a=arguments;return new Promise((function(n,i){var r=t.apply(e,a);function s(t){f(r,n,i,s,o,"next",t)}function o(t){f(r,n,i,s,o,"throw",t)}s(void 0)}))})()},setSelection:function(t){this.clearSelection(),t.editing.enabled()?(this.selectedShape=null,t.editing.disable()):(this.selectedShape=t,t.editing.enable())},clearSelection:function(){this.shapes.eachLayer((function(t){t.editing.disable()})),this.selectedShape=null,this.drawMode=null},deleteSelection:function(){null!==this.selectedShape&&(this.shapes.removeLayer(this.selectedShape),this.selectedShape=null)}}},m=a(2),g=a.n(m),y=a(162),b=a.n(y),_={insert:"head",singleton:!1},w=(g()(b.a,_),b.a.locals,a(8)),k=a(9),S=a.n(k),x=a(103),C=a(113),O=a(31),M=a(657),D=a(42),L=Object(w.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"mainDiv"},[t.readonly?a("v-btn",{style:t.closeBtn,attrs:{fab:"",small:"",color:"primary"},on:{click:function(e){return t.$emit("close")}}},[a("v-icon",[t._v("mdi-close")])],1):a("v-toolbar",{attrs:{dense:"",dark:""}},[a("v-item-group",{staticClass:"v-btn-toggle"},[a("v-btn",{on:{click:function(e){return t.updateMapType()}}},[a("v-icon",[t._v(t._s("roadmap"===t.mapType?"mdi-satellite":"mdi-map"))])],1)],1),t._v(" "),a("v-spacer"),t._v(" "),a("v-item-group",{staticClass:"v-btn-toggle",attrs:{right:""}},[a("v-btn",{attrs:{"input-value":t.isActiveButton("marker")},on:{click:function(e){return t.changeDrawingMode("marker")}}},[a("v-icon",[t._v("mdi-map-marker")])],1),t._v(" "),a("v-btn",{attrs:{"input-value":t.isActiveButton("rectangle")},on:{click:function(e){return t.changeDrawingMode("rectangle")}}},[a("v-icon",[t._v("mdi-vector-rectangle")])],1),t._v(" "),a("v-btn",{attrs:{"input-value":t.isActiveButton("polygon")},on:{click:function(e){return t.changeDrawingMode("polygon")}}},[a("v-icon",[t._v("mdi-vector-polygon")])],1),t._v(" "),a("v-btn",{attrs:{"input-value":t.isActiveButton("circle")},on:{click:function(e){return t.changeDrawingMode("circle")}}},[a("v-icon",[t._v("mdi-vector-circle")])],1)],1),t._v(" "),a("v-spacer"),t._v(" "),a("v-item-group",{staticClass:"v-btn-toggle",attrs:{right:""}},[a("v-btn",{on:{click:function(e){return t.deleteSelection()}}},[a("v-icon",[t._v("mdi-delete")])],1),t._v(" "),a("v-btn",{attrs:{"input-value":t.isChanged,"active-class":"save-btn"},on:{click:function(e){return t.saveShapes()}}},[a("v-icon",[t._v("mdi-content-save")])],1),t._v(" "),a("v-btn",{on:{click:function(e){return t.revertChanges()}}},[a("v-icon",[t._v("mdi-undo")])],1)],1)],1),t._v(" "),a("l-map",{ref:"map",style:"width: "+t.width+"; height: "+t.height,attrs:{center:t.center,zoom:t.zoom},on:{ready:function(e){return t.onMapReady()}}},[a("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}})],1)],1)}),[],!1,null,"043991a4",null);e.a=L.exports;S()(L,{VBtn:x.a,VIcon:C.a,VItemGroup:O.b,VSpacer:M.a,VToolbar:D.a})}}]);