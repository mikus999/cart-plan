(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{170:function(t,e,n){"use strict";n.r(e);var r=n(1),a=n.n(r),s=n(6),i=n.n(s);function o(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){o=!0,s=t},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e,n,r,a,s,i){try{var o=t[s](i),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(r,a)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var s=t.apply(e,n);function i(t){u(s,r,a,i,o,"next",t)}function o(t){u(s,r,a,i,o,"throw",t)}i(void 0)}))}}var f={middleware:["auth","teams"],layout:"vuetify",mixins:[n(11).a],props:{id:{type:[String,Number],required:!0}},components:{},data:function(){return{dialog:!1,date:"",schedData:[],shiftData:[],shiftHeaders:[{text:this.$t("shifts.day"),align:"start",value:"day"},{text:this.$t("shifts.shift_time"),align:"start",value:"shift_time"},{text:this.$t("shifts.location"),value:"location",align:"center"},{text:this.$t("shifts.assignments"),value:"assignments",align:"start",sortable:!1,width:"50%"}],teamUsers:[],shiftUsers:{}}},created:function(){this.initialize()},methods:{initialize:function(){this.getSchedData(),this.getShiftData(),this.getTeamUsers()},getSchedData:function(){var t=this;return l(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.get("/api/schedules/show/"+t.id).then((function(e){t.schedData=e.data,t.date=t.$dayjs(t.schedData.date_start).format("YYYY-MM-DD")}));case 2:case"end":return e.stop()}}),e)})))()},getShiftData:function(){var t=this;return l(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.get("/api/schedules/"+t.id+"/shifts").then((function(e){t.shiftData=e.data;var n,r=o(e.data);try{for(r.s();!(n=r.n()).done;){var a=n.value;t.shiftUsers[a.id]=a.users}}catch(t){r.e(t)}finally{r.f()}}));case 2:case"end":return e.stop()}}),e)})))()},getTeamUsers:function(t){var e=this;return l(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.get("/api/teams/users/"+e.team.id).then((function(t){e.teamUsers=t.data}));case 2:case"end":return t.stop()}}),t)})))()},removeShiftUser:function(t,e){return l(a.a.mark((function n(){var r;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.item,t.attrs,n.next=4,i()({method:"post",url:"/api/schedules/leaveshift",data:{user_id:r.id,shift_id:e.id}}).then((function(t){e.users=t.data.shiftusers}));case 4:case"end":return n.stop()}}),n)})))()},addShiftUser:function(t,e){var n=this;return l(a.a.mark((function r(){var s,o,c;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=t.item,o=t.attrs,c=n.team.setting_shift_assignment_autoaccept?2:0,"true"!==o["aria-selected"]){r.next=7;break}n.removeShiftUser(t,e),r.next=9;break;case 7:return r.next=9,i()({method:"post",url:"/api/schedules/joinshift",data:{user_id:s.id,shift_id:e.id,status:c}}).then((function(t){s.pivot.status=c,e.users=t.data.shiftusers}));case 9:case"end":return r.stop()}}),r)})))()},checkMax:function(t,e){var n="grey darken-3";return t===e?n="green":t<e&&(n="red darken-4"),n}}},d=n(2),v=n.n(d),h=n(197),m=n.n(h),p={insert:"head",singleton:!1},_=(v()(m.a,p),m.a.locals,n(8)),b=n(9),y=n.n(b),x=n(103),g=n(221),k=n(231),w=n(658),S=n(660),$=n(639),U=n(113),D=n(224),V=n(18),A=n(659),C=n(132),T=n(42),I=n(23),j=Object(_.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:""}},[n("v-row",[n("PageTitle",{attrs:{title:t.$t("schedules.schedule")}})],1),t._v(" "),n("v-card",{attrs:{width:"100%"}},[n("v-row",[n("v-col",{staticClass:"text-left",attrs:{xs:"1",sm:"4"}},[n("v-btn",{attrs:{text:"","x-large":t.$vuetify.breakpoint.smAndUp},on:{click:function(e){return t.$router.go(-1)}}},[n("v-icon",{attrs:{left:""}},[t._v("mdi-arrow-left")]),t._v(" "),t.$vuetify.breakpoint.smAndUp?n("span",[t._v(t._s(t.$t("general.go_back")))]):t._e()],1)],1),t._v(" "),n("v-col",{staticClass:"text-center",attrs:{xs:"10",sm:"4"}},[n("span",{staticClass:"text-h6"},[t._v(t._s(t.$t("schedules.week_of"))+" "+t._s(t._f("formatDate")(t.schedData.date_start)))])]),t._v(" "),n("v-col",{staticClass:"text-right",attrs:{xs:"1",sm:"4"}},[n("v-btn",{attrs:{text:"","x-large":t.$vuetify.breakpoint.smAndUp},on:{click:function(t){}}},[t.$vuetify.breakpoint.smAndUp?n("span",[t._v(t._s(t.$t("schedules.approvals")))]):t._e(),t._v(" "),n("v-icon",{attrs:{right:""}},[t._v("mdi-arrow-right")])],1)],1)],1),t._v(" "),n("v-row",[n("v-col",{attrs:{md:"12"}},[n("v-data-table",{attrs:{headers:t.shiftHeaders,items:t.shiftData,"sort-by":"time_start","sort-asc":""},scopedSlots:t._u([{key:"top",fn:function(){return[n("v-toolbar",{attrs:{flat:""}},[n("v-toolbar-title",[t._v(t._s(t.$t("schedules.assignments")))])],1)]},proxy:!0},{key:"item.day",fn:function(e){var n=e.item;return[t._v("\n            "+t._s(t._f("formatDay")(n.time_start))+"\n          ")]}},{key:"item.shift_time",fn:function(e){var n=e.item;return[t._v("\n            "+t._s(t._f("formatTime")(n.time_start))+" - "+t._s(t._f("formatTime")(n.time_end))+"\n          ")]}},{key:"item.location",fn:function(e){var r=e.item;return[n("v-chip",{attrs:{label:"",small:"",color:r.location.color_code}},[t._v(t._s(r.location.name))])]}},{key:"item.assignments",fn:function(e){var r=e.item;return[n("v-select",{staticClass:"no-border",attrs:{items:t.teamUsers,readonly:r.max_participants<=r.users.length||!t.$can("manage_schedules"),"hide-details":"",multiple:"","return-object":"","item-text":"name","item-value":"id",id:"shift"+r.id},scopedSlots:t._u([{key:"prepend-inner",fn:function(){return[n("v-chip",{attrs:{small:"",label:"",color:t.checkMax(r.max_participants,r.users.length)}},[t._v(t._s(r.users.length)+"/"+t._s(r.max_participants))])]},proxy:!0},{key:"selection",fn:function(e){return[n("v-chip",t._b({attrs:{small:"",label:"","input-value":e.selected,close:"",color:void 0!==r.users[e.index].pivot.status?t.shiftStatus[r.users[e.index].pivot.status].color:""},on:{"click:close":function(n){return t.removeShiftUser(e,r)}}},"v-chip",e.attrs,!1),[t._v("\n                  "+t._s(e.item.name)+"\n                ")])]}},{key:"item",fn:function(e){return[n("v-list-item-avatar",[n("v-icon",{attrs:{color:"true"===e.attrs["aria-selected"]?"green":"red"}},[t._v("mdi-checkbox-blank-circle")])],1),t._v(" "),n("v-list-item-content",{on:{click:function(n){return t.addShiftUser(e,r)}}},[n("v-list-item-title",[t._v(t._s(e.item.name))]),t._v(" "),n("v-list-item-subtitle")],1)]}}],null,!0),model:{value:r.users,callback:function(e){t.$set(r,"users",e)},expression:"item.users"}})]}}])})],1)],1)],1)],1)}),[],!1,null,null,null);e.default=j.exports;y()(j,{VBtn:x.a,VCard:g.a,VChip:k.a,VCol:w.a,VContainer:S.a,VDataTable:$.a,VIcon:U.a,VListItemAvatar:D.a,VListItemContent:V.b,VListItemSubtitle:V.c,VListItemTitle:V.d,VRow:A.a,VSelect:C.a,VToolbar:T.a,VToolbarTitle:I.a})},197:function(t,e,n){(e=n(10)(!1)).push([t.i,".no-border.v-text-field>.v-input__control>.v-input__slot:after,.no-border.v-text-field>.v-input__control>.v-input__slot:before{border-style:none}",""]),t.exports=e}}]);